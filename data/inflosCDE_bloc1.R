## Script qui simule des inflos C/D/E pour le bloc 1
## Utilise les débourrements observés pour ER et PS
## Utilise les débourrements simulés pour EH


# Packages / data ---------------------------------------------------------

library(tidyverse)
bursts_dataset1 <- read.csv("2017_bursts_echelle_bloc1.csv")

## Débourrements observés
burstERobs <- bursts_dataset1$burstER
burstPSobs <- bursts_dataset1$burstPS
## Débourrements simulés
burstER <- c(350.0134343452573, 453.0494680425028, 111.41292783253148, 105.4176075524184,
             106.14146989801527, 106.88419984201273, 107.92798314266074, 27.862121398660715, 
             26.76922996155252, 25.358363282095244, 25.54519926027305, 26.41473950792908, 
             27.007805792169464, 28.189144320188845, 122.8007618803285, 128.3152149460844,
             101.53006793971205, 102.33544605578878, 104.74898408664677, 102.96824259332047,
             121.16128750960435, 134.7787425587716, 137.86280269690303, 137.01578907675332,
             139.7596137548663, 142.57200716958042, 145.70417381412688, 154.58366499420154, 
             37.24443126919395, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
             46.82048999967827, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 89.78342873052377,
             144.49181086038928, 135.12353798107915, 132.69392868814563, 131.2803785071253, 
             129.6511363926496, 127.96846943359883, 79.59601412352224, 76.77659518316676, 
             6.2627699110336845, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 10.67835733741944, 
             36.910199285431624, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)
burstPS <- c(231.35134498309577, 263.1403688655092, 35.519398739122536, 31.215276884534056,
             31.79127788960595, 31.583174941078404, 27.640386994722814, 14.635660924044249,
             14.993744364076822, 6.1507722412770045, 5.63795948726839, 0.7257925024988745,
             0.0, 0.0, 75.4595353180211, 82.00232081716146, 17.8869887330277, 22.031034975909087, 
             22.79195886181951, 10.221408347499747, 57.75228834845634, 7.847338390478435, 0.0,
             0.0, 0.0, 0.0, 0.0, 0.0, 17.390700893578728, 10.609708410549484, 0.0, 19.363579198503697,
             39.87554903766926, 40.48034835461954, 21.077981753081588, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
             0.0, 7.623219674981039, 120.08536501224773, 122.45307526157539, 116.3976867246767, 
             116.15027405087227, 116.60636777369129, 116.8083064709301, 116.82490644302892, 
             533.106536317362, 560.4567648461133, 140.00994342817992, 132.54929197450312,
             133.98619823729632, 133.91811097302968, 73.78742001818966, 0.0, 0.0, 51.87075831583061, 
             54.81638852567342, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 106.45969010628332, 148.99610796959686,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)
burstEH <- c(180.25526992154695, 226.4936275997441, 45.307288331510335, 41.830591828513484, 
             42.459873262367445, 41.513904182456194, 16.444664672369008, 48.81911577305092,
             51.78093673625543, 23.632431806994763, 22.215401686226823, 21.092401323262774,
             19.75710680770917, 18.939874846341613, 57.85483855055529, 61.264141439995974,
             18.558375145392965, 15.228234310169707, 12.339015543243248, 10.107907329043584,
             56.57018423922785, 69.7204379136405, 73.39554865212266, 60.48088882226898,
             62.52913543682146, 65.04068749631428, 67.8495593231891, 72.64188499930185,
             54.048468319005345, 0.0, 0.0, 0.0, 0.0, 13.74297566369447, 18.78743554547672, 
             8.201569977850445, 0.0, 0.0, 272.0025461613084, 291.05531639789984, 293.04305813638183,
             295.13692413595504, 339.0804362944493, 342.20498733445817, 344.48633781059795,
             189.67182503217072, 188.37403396318862, 190.65850372114684, 192.83008224721402,
             195.24765293695233, 643.2649930205931, 671.037358038544, 356.2633431972951, 
             353.73502886675954, 358.28397128334166, 356.0093372915361, 11.437054191174589,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)


# Simulation --------------------------------------------------------------

mu <- 29
sigma <- 14
CDF_norm <- pnorm(1:50, mu, sigma)

inflosCDE <- function(burst) {
    inflos <- rep(NA, length(burst))
    inflos[1] <- burst[1]
    days <- 1:(length(burst)+3) ## Pour arriver au 80 jours avec les burst du dataset 1
    for (t in days[-1]) {
        temp <- 0
        for (j in 1:min(16, t-1)) {
            temp <- temp + burst[t-j] * (1 - CDF_norm[j]) 
        } 
        inflos[t] <- burst[t] + temp
    }
    inflos
}


inflosCDE_ER <- inflosCDE(burstER)
inflosCDE_PS <- inflosCDE(burstPS)
inflosCDE_EH <- inflosCDE(burstEH)


ind <- which(bursts_dataset1$date == "2017-07-19")

inflosCDE_bloc1 <- cbind(inflosCDE_ER[1:80],
                         inflosCDE_PS[1:80],
                         inflosCDE_EH[1:80])

# write.csv(inflosCDE_bloc1, file = "2017_inflosCDE_bloc1.csv")
