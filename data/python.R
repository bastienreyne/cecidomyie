## Script inutile
simu_ER <- c(350.0134343452573,
             453.0494680425028,
             554.155460698015,
             655.1619181943995,
             756.2901485008645,
             857.3345405600837,
             958.4922830855359,
             978.5358535119204,
             998.1639973278855,
             1015.471649907787,
             1031.9895053386335,
             1048.2918592694916,
             1064.010289536864,
             1079.6627141622068,
             1188.593999726279,
             1299.5118893935214,
             1381.6931126665656,
             1463.3314099235968,
             1545.4092716918099,
             1623.6038578464577,
             1717.8918088833996,
             1823.1739262026645,
             1928.8782298202484,
             2031.1874179960873,
             2133.6996247087927,
             2236.341949492591,
             2339.3664622784304,
             2448.4532240452563,
             2437.197615309591,
             2388.4926057982,
             2338.2115488235654,
             2285.7043540190384,
             2231.0497889188646,
             2174.341698477577,
             2115.6886824777093,
             2055.213654959252,
             1993.0532891270568,
             1929.357349954992,
             1864.2879153657673,
             1798.0184856263697,
             1777.553469664931,
             1708.379934251659,
             1639.4560720971178,
             1570.0900064891478,
             1500.4920546353533,
             1430.876129723809,
             1361.4580963009073,
             1292.4540383671274,
             1224.0784554189197,
             1156.5424060378443,
             1179.8350516515527,
             1226.7703149315935,
             1290.949096079537,
             1354.8255209642698,
             1418.7921775073432,
             1482.6181005723752,
             1546.2232297598182,
             1568.311269310066,
             1589.4644859243483,
             1541.1569543041758,
             1489.069768172495,
             1438.229351092757,
             1388.5428977175438,
             1339.959800788765,
             1286.2164074118114,
             1234.0479663065473,
             1185.515470433919,
             1149.0666691149484,
             1139.7850008308083,
             1094.306270340885,
             1049.3890549322246,
             1004.6746082049422,
             960.86189833569,
             918.1165733797712,
             876.0798232485172,
             834.6773883183206,
             793.8341537210301,
             753.1311437893781,
             721.031905280046,
             691.1206785333828)

simu_PS <- c(231.35134498309577,
             263.1403688655092,
             292.67328949204887,
             321.9905909899573,
             351.6737949919439,
             380.8074315836434,
             405.63410949138836,
             417.13701895332633,
             428.85890125782123,
             431.30673161263405,
             432.9835604103839,
             429.3021407116246,
             424.52209481407044,
             419.26739635931585,
             488.96248478041707,
             562.9559691888785,
             571.830971658321,
             585.3714388413742,
             598.8472863724924,
             598.9665652463688,
             646.1124909459029,
             641.5197563431205,
             629.2641076991645,
             616.4179258514815,
             602.8439557391453,
             588.56198570472,
             573.5985258724058,
             557.9867272754734,
             559.1568917119314,
             552.5874365954112,
             534.9790237723361,
             536.4662450304008,
             557.6133745341147,
             578.4705464354471,
             579.4535667668983,
             559.383267293698,
             539.4987280944623,
             519.4605267543479,
             499.33308453563285,
             479.1801523142656,
             459.06417913428436,
             439.0457329461774,
             426.80620185170335,
             527.0664000440825,
             627.3673059152433,
             721.3685653550214,
             815.0308528383815,
             908.9086056820686,
             1002.6825070462253,
             1096.1094827532906,
             1605.3845264073873,
             2114.441584762829,
             2217.6049229088553,
             2320.4151457441367,
             2423.3228617091145,
             2524.5066572302444,
             2563.973912324273,
             2529.793397350786,
             2495.0937872716772,
             2510.8263736839867,
             2526.1365872703705,
             2484.354455288666,
             2441.162690296984,
             2395.3900179239054,
             2341.94896833417,
             2286.0808840299846,
             2232.493642356943,
             2282.480115330153,
             2370.0061900001792,
             2305.5259004517197,
             2238.1331654277674,
             2172.03444742773,
             2104.1034420835977,
             2033.9463752363888,
             1961.7970060148086,
             1887.9134815391474,
             1812.575494653974,
             1736.080976309813,
             1657.5805662335592,
             1579.1645221312185)

simu_EH <- c(180.25526992154695,
             226.4936275997441,
             266.6481560179385,
             306.50988427521605,
             346.7538388345295,
             385.68389420309916,
             399.1670957812428,
             445.1537199646189,
             492.9798700856247,
             512.0349776938655,
             529.6904525143298,
             545.6893342682675,
             559.7744733119106,
             572.4306861394538,
             623.3430043880261,
             676.066985773371,
             685.0989630518079,
             690.793890498314,
             692.8175292073289,
             691.8034860862315,
             736.420990188338,
             792.2459655305047,
             850.3631017968391,
             894.3168795807755,
             939.4020920495917,
             985.7664617690509,
             1033.6712070870824,
             1085.068727237865,
             1116.505299849849,
             1093.028963775688,
             1069.5631967964887,
             1045.1077964415997,
             1019.7049285832878,
             1007.1463232791099,
             998.47585122615,
             978.2651325567618,
             949.2912720658276,
             919.8047157521768,
             1161.7245853601148,
             1415.9908170024944,
             1670.2478297115147,
             1924.8292765771482,
             2221.466311529007,
             2518.253612571415,
             2814.950290089946,
             2954.277465071631,
             3093.104157425286,
             3231.926541767932,
             3370.3945751101182,
             3508.5767372841915,
             4091.8774105255156,
             4674.583544813652,
             4950.879308927167,
             5226.54464839276,
             5502.006693609583,
             5770.027774140339,
             5689.673993373085,
             5597.443108305513,
             5500.521580197994,
             5400.640743643966,
             5295.646541213544,
             5185.451704148042,
             5070.049360348974,
             4949.429502984683,
             4821.017864941723,
             4687.667974708812,
             4552.648873083147,
             4413.168428182495,
             4269.478443256749,
             4121.877457380895,
             3967.515329640554,
             3809.498000164731,
             3649.048010834857,
             3487.8100077485055,
             3325.208798800121,
             3161.8114463859374,
             2998.2203715038463,
             2834.9398235753515,
             2674.189640617805,
             2518.784114022615)

simu_attra_ER <- c(350.0134343452573, 453.0494680425028, 519.4875423433269, 607.9336785220067, 695.7097594328704, 782.1014750269784, 867.2628666224562, 869.9116126622566, 876.9300579989879, 881.0818350013842, 883.9901931484651, 886.1909747977722, 887.3455616601582, 888.0797526878146, 981.7918810180802, 1070.1416262445478, 1128.4989159956067, 1187.5489458317995, 1246.4733966164217, 1300.911524093673, 1371.234386927714, 1450.9254479708306, 1529.6973074333773, 1604.5022881843463, 1679.287024143572, 1753.7822849395516, 1828.278759753181, 1908.4701430774585, 1867.5418835447704, 1798.0184856263697, 1730.7329796652527, 1662.6246165773518, 1593.8946807948016, 1524.751170378296, 1455.4073296846361, 1386.0800702860085, 1316.9882873864883, 1248.3510829686202, 1180.3859113181566, 1113.3066671827376, 1094.142231352746, 1024.804627187324, 960.9908731128195, 898.7889569012149, 838.3649244712789, 779.8707133903748, 723.4427629088113, 669.2008235338332, 617.246993776468, 567.6650067312078, 610.3032119235694, 695.146643319387, 772.1365962583635, 848.3322435061008, 923.8783299981734, 998.2864164529346, 1071.323533565897, 1097.1884458548816, 1124.6157686499341, 1081.8103984345385, 1039.5957347379535, 998.6104523945587, 958.2485127981577, 918.4458778359243, 877.9044976814097, 837.9956197788814, 799.1069098540066, 771.4435305010539, 769.4630782711303, 728.4011716871966, 690.8229540818926, 653.6324930011762, 617.0346237366997, 581.1289269337136, 545.9145522737338, 511.4545743304761, 477.813819341433, 444.98778543910106, 414.7543430167522, 385.8357359468653)

simu_attra_PS <- c(231.35134498309577, 263.1403688655092, 272.5374556214833, 296.7932370073731, 321.2778849858024, 344.729635091978, 363.4415989344907, 368.6846354630537, 374.73532190859555, 371.2069007412754, 367.3292386348555, 357.9872711218446, 347.8226636027066, 337.2281889830784, 401.63108056684405, 464.66074905055586, 461.5587873647559, 467.47245852597354, 473.0327712495337, 465.2220534613119, 505.4868381311983, 490.62351481093987, 471.7948309901738, 453.32383344110843, 434.59360174806193, 415.6753227822493, 396.64187798020964, 377.5670177713657, 375.91523369472145, 365.8614468566398, 345.82103158724686, 346.28440773505565, 365.61598276193473, 383.60375516338433, 381.9841470743918, 361.06562323141105, 342.3450735672743, 324.0218118970413, 306.13266824597576, 288.7104186888487, 271.78381047735166, 255.37763597121136, 247.13606729282682, 351.15852304474873, 446.8573364262847, 535.2726457203947, 622.8828742509021, 709.7501311191104, 795.4121556616185, 879.5586692704265, 1378.3243711360547, 1857.7812156036694, 1910.3420758544273, 1988.8581742917847, 2065.969502317242, 2139.224649443466, 2148.595864624098, 2086.376487634843, 2028.184634477232, 2019.652806161459, 2006.689783493934, 1935.920117673258, 1867.905893642089, 1798.0516728566934, 1725.5786122471286, 1651.8392442701738, 1578.0491564369013, 1609.8805562161851, 1673.2090743725878, 1581.9606944855218, 1502.9572180507755, 1424.9188905122505, 1347.474457829018, 1270.819607155645, 1195.265054093004, 1121.1066025443579, 1048.6216002430015, 978.0658156375131, 909.4376794092999, 843.3058644125558)

simu_attra_EH <- c(180.25526992154695, 226.4936275997441, 249.31657714331462, 283.69417984545726, 318.1873841808058, 350.79879610682985, 357.4986121508929, 398.0840950090815, 437.717412017422, 447.7688434363902, 457.9692668291119, 466.27673126896923, 472.4567091896598, 477.05933703864787, 519.7869869353209, 561.2128290119308, 558.2588562909394, 554.8148664510672, 547.9520986988532, 538.3659451424454, 574.77003629838, 619.1047959147061, 664.6609195076022, 695.6324768543084, 728.5829504524906, 762.6575749699174, 798.0960936411025, 836.8335714410531, 855.2624247086196, 820.1954388153314, 789.4467102797083, 758.381277042013, 727.0888147238135, 709.4039308306988, 695.3568131655057, 670.0950563952753, 637.5663589653219, 605.9443886946726, 846.6060747621699, 1079.6890054835926, 1309.7770458874993, 1538.1848324160874, 1806.454953946607, 2069.3042596909854, 2329.076659503892, 2428.3718170246316, 2535.919021839117, 2641.7274989746556, 2745.1818817700264, 2846.362586326198, 3390.6851647603357, 3910.4885246405343, 4104.984693590809, 4316.594271202536, 4524.820279526046, 4721.964407853944, 4566.478627847525, 4424.524818367693, 4279.327929598974, 4130.657723984653, 3978.4900253853284, 3823.276029778532, 3665.520134965603, 3505.756939168024, 3344.031054416067, 3181.5132330678875, 3019.442268526551, 2857.8185960263527, 2697.2736081881567, 2538.4325952484764, 2381.265562383231, 2226.9308534521124, 2076.1458284653745, 1929.6620697294286, 1787.7281150841773, 1650.7783941984317, 1519.1976862458923, 1393.2921169364504, 1273.6530275869648, 1160.9190663424727)

piege <- read_csv("2017_piege.csv") %>% select(date, inflos, Sol)
piege_ER <- piege %>% filter(Sol == "ER") %>% pull(inflos)
piege_PS <- piege %>% filter(Sol == "PS") %>% pull(inflos)
piege_EH <- piege %>% filter(Sol == "EH") %>% pull(inflos)


s_ER <- cbind(date = piege$date,
              IT2 = piege_ER,
              ITS = simu_attra_ER,
              ITO = simu_ER) %>% 
    as_tibble %>% 
    mutate_at("date", as_date) %>% 
    gather(IT2, ITO, ITS, key = inflos, value = Nombre)

s_ER %>% ggplot(aes(x = date, y = Nombre, color = inflos)) +
    geom_line(lwd = 0.75) +
    xlab("Date") +
    theme(legend.title = element_blank(), legend.text = element_text(size = 14)) +
    scale_color_discrete(labels = c(expression(I[t]^{2}), 
                                    expression(I[t]^{o}),
                                    expression(I[t]^{s}))) +
    labs(title = "Enherbement ras") +
    ylim(c(0, 6001))

s_PS <- cbind(date = piege$date,
              IT2 = piege_PS,
              ITS = simu_attra_PS,
              ITO = simu_PS) %>% 
    as_tibble %>% 
    mutate_at("date", as_date) %>% 
    gather(IT2, ITO, ITS, key = inflos, value = Nombre)

s_PS %>% ggplot(aes(x = date, y = Nombre, color = inflos)) +
    geom_line(lwd = 0.75) +
    xlab("Date") +
    theme(legend.title = element_blank(), legend.text = element_text(size = 14)) +
    scale_color_discrete(labels = c(expression(I[t]^{2}), 
                                    expression(I[t]^{o}),
                                    expression(I[t]^{s}))) +
    labs(title = "Paillage synthétique") +
    ylim(c(0, 6001))

s_EH <- cbind(date = piege$date,
              IT2 = piege_EH,
              ITS = simu_attra_EH,
              ITO = simu_EH) %>% 
    as_tibble %>% 
    mutate_at("date", as_date) %>% 
    gather(IT2, ITO, ITS, key = inflos, value = Nombre)

s_EH %>% ggplot(aes(x = date, y = Nombre, color = inflos)) +
    geom_line(lwd = 0.75) +
    xlab("Date") +
    theme(legend.title = element_blank(), legend.text = element_text(size = 14)) +
    scale_color_discrete(labels = c(expression(I[t]^{2}), 
                                    expression(I[t]^{o}),
                                    expression(I[t]^{s}))) +
    labs(title = "Enherbement haut") +
    ylim(c(0, 6001))




# Comparaison deux approches ----------------------------------------------

ITA_ER <- attra_ER %>% filter(Inflorescences == "Attractives") %>% pull(Nombre)
ITA_PS <- attra_PS %>% filter(Inflorescences == "Attractives") %>% pull(Nombre)
ITA_EH <- attra_EH %>% filter(Inflorescences == "Attractives") %>% pull(Nombre)

comp_ER <- cbind(date = piege$date,
                 ITA = ITA_ER,
                 ITS = simu_attra_ER) %>% 
    as_tibble %>% 
    mutate_at("date", as_date) %>% 
    gather(ITA, ITS, key = inflos, value = Nombre)

comp_ER %>% ggplot(aes(x = date, y = Nombre, color = inflos)) +
    geom_line(lwd = 0.75) +
    xlab("Date") +
    theme(legend.title = element_blank(), legend.text = element_text(size = 14)) +
    scale_color_discrete(labels = c(expression(I[t]^{a}),
                                    expression(I[t]^{s}))) +
    labs(title = "Enherbement ras") +
    ylim(c(0, 4800))

comp_PS <- cbind(date = piege$date,
                 ITA = ITA_PS,
                 ITS = simu_attra_PS) %>% 
    as_tibble %>% 
    mutate_at("date", as_date) %>% 
    gather(ITA, ITS, key = inflos, value = Nombre)

comp_PS %>% ggplot(aes(x = date, y = Nombre, color = inflos)) +
    geom_line(lwd = 0.75) +
    xlab("Date") +
    theme(legend.title = element_blank(), legend.text = element_text(size = 14)) +
    scale_color_discrete(labels = c(expression(I[t]^{a}),
                                    expression(I[t]^{s}))) +
    labs(title = "Paillage synthétique") +
    ylim(c(0, 4800))

comp_EH <- cbind(date = piege$date,
                 ITA = ITA_EH,
                 ITS = simu_attra_EH) %>% 
    as_tibble %>% 
    mutate_at("date", as_date) %>% 
    gather(ITA, ITS, key = inflos, value = Nombre)

comp_EH %>% ggplot(aes(x = date, y = Nombre, color = inflos)) +
    geom_line(lwd = 0.75) +
    xlab("Date") +
    theme(legend.title = element_blank(), legend.text = element_text(size = 14)) +
    scale_color_discrete(labels = c(expression(I[t]^{a}),
                                    expression(I[t]^{s}))) +
    labs(title = "Enherbement haut") +
    ylim(c(0, 4800))

simu_attra <- cbind(unique(piege$date),
                    simu_attra_ER,
                    simu_attra_PS,
                    simu_attra_EH)

write.csv(simu_attra, file = "attractive_simulated.csv")

simu <- cbind(unique(piege$date),
              simu_ER,
              simu_PS,
              simu_EH)

write.csv(simu, file = "inflos_simulated.csv")

ita <- cbind(unique(piege$date), 
             ITA_ER,
             ITA_PS,
             ITA_EH)

write.csv(ita, file = "2017_attractives.csv")
