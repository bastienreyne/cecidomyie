for (day in 1:length(date)) {
inflos_floraison_ER[day] <- floraison2017_ER %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_PS[day] <- floraison2017_PS %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_EH[day] <- floraison2017_EH %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
alive[day] <- floraison2017 %$% which(birth == date[day]) %>% na.omit %>% length
dead[day] <- floraison2017 %$% which(death == date[day]) %>% na.omit %>%  length
alive_ER[day] <- floraison2017_ER %$% which(birth == date[day]) %>% na.omit %>%  length
alive_PS[day] <- floraison2017_PS %$% which(birth == date[day]) %>% na.omit %>%  length
alive_EH[day] <- floraison2017_EH %$% which(birth == date[day]) %>% na.omit %>%  length
}
inflos_floraison_ER <- cbind(date, inflos = inflos_floraison_ER) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "ER")
inflos_floraison_ER
for (day in 1:length(date)) {
inflos_floraison_ER[day] <- floraison2017_ER %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_PS[day] <- floraison2017_PS %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_EH[day] <- floraison2017_EH %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
alive[day] <- floraison2017 %$% which(birth == date[day]) %>% na.omit %>% length
dead[day] <- floraison2017 %$% which(death == date[day]) %>% na.omit %>%  length
alive_ER[day] <- floraison2017_ER %$% which(birth == date[day]) %>% na.omit %>%  length
alive_PS[day] <- floraison2017_PS %$% which(birth == date[day]) %>% na.omit %>%  length
alive_EH[day] <- floraison2017_EH %$% which(birth == date[day]) %>% na.omit %>%  length
}
inflos_floraison_ER <- rep(NA, length(date))
inflos_floraison_PS <- rep(NA, length(date))
inflos_floraison_EH <- rep(NA, length(date))
alive <- rep(NA, length(date))
dead <- rep(NA, length(date))
alive_ER <- rep(NA, length(date))
alive_PS <- rep(NA, length(date))
alive_EH <- rep(NA, length(date))
for (day in 1:length(date)) {
inflos_floraison_ER[day] <- floraison2017_ER %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_PS[day] <- floraison2017_PS %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_EH[day] <- floraison2017_EH %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
alive[day] <- floraison2017 %$% which(birth == date[day]) %>% na.omit %>% length
dead[day] <- floraison2017 %$% which(death == date[day]) %>% na.omit %>%  length
alive_ER[day] <- floraison2017_ER %$% which(birth == date[day]) %>% na.omit %>%  length
alive_PS[day] <- floraison2017_PS %$% which(birth == date[day]) %>% na.omit %>%  length
alive_EH[day] <- floraison2017_EH %$% which(birth == date[day]) %>% na.omit %>%  length
}
floraison_ER <- cbind(date, inflos = inflos_floraison_ER) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "ER")
floraison20_ER
floraison_ER
plot(floraison$inflos)
plot(floraison_ER$inflos)
plot(floraison_EH$inflos)
floraison_PS <- cbind(date, inflos = inflos_floraison_PS) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "PS")
floraison_EH <- cbind(date, inflos = inflos_floraison_EH) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "EH")
plot(floraison_EH$inflos)
floraison2017_EH %>% ggplot(aes(x = date, y = inflos))
floraison_ER %>% ggplot(aes(x = date, y = inflos)) + geom_line()
# Packages / data ---------------------------------------------------------
library(tidyverse)
library(magrittr)
library(lubridate)
inflos_piege <- read_csv("2017_piege.csv") %>% select(date, inflos, Sol)
inflos_floraison <- read_csv2("raw/floraison0.csv")
inflos_floraison %<>% mutate_at(c("ApdateC", "ApdateM",
c(paste0("Lat",1:5,"dateC"),
paste0("Lat", 1:5, "dateM"))), dmy) %>%
filter(Annee == 2017) %>%
filter(Bloc == 1)
inflos_floraison$Traitm[which(inflos_floraison$Traitm == "Sn")] <- "ER"
inflos_floraison$Traitm[which(inflos_floraison$Traitm == "B")] <- "PS"
inflos_floraison$Traitm[which(inflos_floraison$Traitm == "E")] <- "EH"
# Mise en forme inflo floraison -------------------------------------------
inflos_apic <- inflos_floraison %>% filter(!is.na(ApdateC)) %>%
select(Traitm, ApdateC, ApdateM) %>%
rename(birth = ApdateC, death = ApdateM)
inflos_lat1 <- inflos_floraison %>% filter(!is.na(Lat1dateC)) %>%
select(Traitm, Lat1dateC, Lat1dateM) %>%
rename(birth = Lat1dateC, death = Lat1dateM)
inflos_lat2 <- inflos_floraison %>% filter(!is.na(Lat2dateC)) %>%
select(Traitm, Lat2dateC, Lat2dateM) %>%
rename(birth = Lat2dateC, death = Lat2dateM)
inflos_lat3 <- inflos_floraison %>% filter(!is.na(Lat3dateC)) %>%
select(Traitm, Lat3dateC, Lat3dateM) %>%
rename(birth = Lat3dateC, death = Lat3dateM)
inflos_lat4 <- inflos_floraison %>% filter(!is.na(Lat4dateC)) %>%
select(Traitm, Lat4dateC, Lat4dateM) %>%
rename(birth = Lat4dateC, death = Lat4dateM)
inflos_lat5 <- inflos_floraison %>% filter(!is.na(Lat5dateC)) %>%
select(Traitm, Lat5dateC, Lat5dateM) %>%
rename(birth = Lat5dateC, death = Lat5dateM)
floraison2017 <- rbind(inflos_apic, inflos_lat1, inflos_lat2,
inflos_lat3, inflos_lat4, inflos_lat5) %>%
arrange(birth)
# write.csv(floraison2017, file = "2017_floraison_not_corrected.csv")
floraison2017_ER <- floraison2017 %>% filter(Traitm == "ER")
floraison2017_PS <- floraison2017 %>% filter(Traitm == "PS")
floraison2017_EH <- floraison2017 %>% filter(Traitm == "EH")
date <- floraison2017 %$% unique(c(birth, death)) %>% na.omit
date <- min(date):max(date) %>% as_date
inflos_floraison_ER <- rep(NA, length(date))
inflos_floraison_PS <- rep(NA, length(date))
inflos_floraison_EH <- rep(NA, length(date))
alive <- rep(NA, length(date))
dead <- rep(NA, length(date))
alive_ER <- rep(NA, length(date))
alive_PS <- rep(NA, length(date))
alive_EH <- rep(NA, length(date))
for (day in 1:length(date)) {
inflos_floraison_ER[day] <- floraison2017_ER %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_PS[day] <- floraison2017_PS %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_EH[day] <- floraison2017_EH %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
alive[day] <- floraison2017 %$% which(birth == date[day]) %>% na.omit %>% length
dead[day] <- floraison2017 %$% which(death == date[day]) %>% na.omit %>%  length
alive_ER[day] <- floraison2017_ER %$% which(birth == date[day]) %>% na.omit %>%  length
alive_PS[day] <- floraison2017_PS %$% which(birth == date[day]) %>% na.omit %>%  length
alive_EH[day] <- floraison2017_EH %$% which(birth == date[day]) %>% na.omit %>%  length
}
floraison_ER <- cbind(date, inflos = inflos_floraison_ER) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "ER")
floraison_PS <- cbind(date, inflos = inflos_floraison_PS) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "PS")
floraison_EH <- cbind(date, inflos = inflos_floraison_EH) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "EH")
floraison2017
inflos_floraison_EH
inflos_floraison_ER
floraison_EH
alive
plot(alive)
floraison2017_ER <- floraison2017 %>% filter(Traitm == "ER")
floraison2017_PS <- floraison2017 %>% filter(Traitm == "PS")
floraison2017_EH <- floraison2017 %>% filter(Traitm == "EH")
date <- floraison2017 %$% unique(c(birth, death)) %>% na.omit
date <- min(date):max(date) %>% as_date
inflos_floraison_ER <- rep(NA, length(date))
inflos_floraison_PS <- rep(NA, length(date))
inflos_floraison_EH <- rep(NA, length(date))
alive <- rep(NA, length(date))
dead <- rep(NA, length(date))
alive_ER <- rep(NA, length(date))
alive_PS <- rep(NA, length(date))
alive_EH <- rep(NA, length(date))
for (day in 1:length(date)) {
inflos_floraison_ER[day] <- floraison2017_ER %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_PS[day] <- floraison2017_PS %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_EH[day] <- floraison2017_EH %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
alive[day] <- floraison2017 %$% which(birth == date[day]) %>% na.omit %>% length
dead[day] <- floraison2017 %$% which(death == date[day]) %>% na.omit %>%  length
alive_ER[day] <- floraison2017_ER %$% which(birth == date[day]) %>% na.omit %>%  length
alive_PS[day] <- floraison2017_PS %$% which(birth == date[day]) %>% na.omit %>%  length
alive_EH[day] <- floraison2017_EH %$% which(birth == date[day]) %>% na.omit %>%  length
}
plot(alive)
plot(inflos_floraison_EH)
rm(list = ls())
setwd("/home/bastien/Stage/Moi/")
source('~/Stage/Moi/floraison2017.R')
inflos_floraison_ER
plot(inflos_floraison_ER$inflos)
rm(list=ls())
setwd("/home/bastien/cecidomyie/data/")
source('~/cecidomyie/data/floraison2017.R')
inflos_floraison
floraison2017_ER
floraison_ER
plot(floraison_ER$inflos)
floraison2017
inflos_floraison_all <- rep(NA, length(date))
for (day in 1:length(date)) {
inflos_floraison_ER[day] <- floraison2017_ER %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_PS[day] <- floraison2017_PS %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_EH[day] <- floraison2017_EH %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_all[day] <- floraison2017 %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
alive[day] <- floraison2017 %$% which(birth == date[day]) %>% na.omit %>% length
dead[day] <- floraison2017 %$% which(death == date[day]) %>% na.omit %>%  length
alive_ER[day] <- floraison2017_ER %$% which(birth == date[day]) %>% na.omit %>%  length
alive_PS[day] <- floraison2017_PS %$% which(birth == date[day]) %>% na.omit %>%  length
alive_EH[day] <- floraison2017_EH %$% which(birth == date[day]) %>% na.omit %>%  length
}
inflos_floraison_all
inflos_floraison <- read_csv2("raw/floraison0.csv")
inflos_floraison %<>% mutate_at(c("ApdateC", "ApdateM",
c(paste0("Lat",1:5,"dateC"),
paste0("Lat", 1:5, "dateM"))), dmy) %>%
filter(Annee == 2017) %>%
filter(Bloc == 1)
inflos_floraison <- read_csv2("/home/bastien/Stage/Moi/Data/raw/2017_floraison.csv")
inflos_floraison %<>% mutate_at(c("ApdateC", "ApdateM",
c(paste0("Lat",1:5,"dateC"), paste0("Lat", 1:5, "dateM"))), dmy) %>%
filter(Annee == 2017) %>%
mutate_at("Traitm", as_factor) %>%
filter(Bloc == 1)
inflos_floraison
inflos_floraison2 <- read_csv2("raw/floraison0.csv")
inflos_floraison2 %<>% mutate_at(c("ApdateC", "ApdateM",
c(paste0("Lat",1:5,"dateC"),
paste0("Lat", 1:5, "dateM"))), dmy) %>%
filter(Annee == 2017) %>%
filter(Bloc == 1)
inflos_floraison-inflos_floraison2
dim(inflos_floraison)
dim(inflos_floraison2)
str(inflos_floraison)
str(inflos_floraison2)
inflos_floraison$ApdateC-inflos_floraison2$ApdateC
inflos_floraison2 <- read_csv2("raw/floraison0.csv")
inflos_floraison2 %<>% mutate_at(c("ApdateC", "ApdateM",
c(paste0("Lat",1:5,"dateC"),
paste0("Lat", 1:5, "dateM"))), dmy) %>%
filter(Annee == 2017) %>%
filter(Bloc == 1)
inflos_floraison$ApNAture
source('~/Stage/Moi/floraison2017.R')
setwd("/home/bastien/Stage/Moi/")
source('~/Stage/Moi/floraison2017.R')
rm(list=ls())
inflos_floraison2 <- read_csv2("raw/floraison0.csv")
setwd("/home/bastien/cecidomyie/data/")
# Packages / data ---------------------------------------------------------
library(tidyverse)
library(magrittr)
library(lubridate)
inflos_piege <- read_csv("2017_piege.csv") %>% select(date, inflos, Sol)
inflos_floraison2 <- read_csv2("raw/floraison0.csv")
inflos_floraison2 %<>% mutate_at(c("ApdateC", "ApdateM",
c(paste0("Lat",1:5,"dateC"),
paste0("Lat", 1:5, "dateM"))), dmy) %>%
filter(Annee == 2017) %>%
filter(Bloc == 1)
inflos_floraison$Traitm[which(inflos_floraison$Traitm == "Sn")] <- "ER"
inflos_floraison$Traitm[which(inflos_floraison$Traitm == "B")] <- "PS"
inflos_floraison$Traitm[which(inflos_floraison$Traitm == "E")] <- "EH"
inflos_floraison <- read_csv2("raw/floraison0.csv")
inflos_floraison %<>% mutate_at(c("ApdateC", "ApdateM",
c(paste0("Lat",1:5,"dateC"),
paste0("Lat", 1:5, "dateM"))), dmy) %>%
filter(Annee == 2017) %>%
filter(Bloc == 1)
source('~/cecidomyie/data/data_floraison.R')
data
## Importation des données
data <- read_csv2("raw/2017_floraison.csv")
data %<>% mutate_at(c("ApdateC", "ApdateM",
c(paste0("Lat",1:5,"dateC"),
paste0("Lat", 1:5, "dateM"))), dmy)
inflos_floraison <- read_csv2("raw/2017_floraison.csv")
inflos_floraison %<>% mutate_at(c("ApdateC", "ApdateM",
c(paste0("Lat",1:5,"dateC"),
paste0("Lat", 1:5, "dateM"))), dmy) %>%
filter(Annee == 2017) %>%
filter(Bloc == 1)
inflos_floraison$Traitm[which(inflos_floraison$Traitm == "Sn")] <- "ER"
inflos_floraison$Traitm[which(inflos_floraison$Traitm == "B")] <- "PS"
inflos_floraison$Traitm[which(inflos_floraison$Traitm == "E")] <- "EH"
inflos_apic <- inflos_floraison %>% filter(!is.na(ApdateC)) %>%
select(Traitm, ApdateC, ApdateM) %>%
rename(birth = ApdateC, death = ApdateM)
inflos_lat1 <- inflos_floraison %>% filter(!is.na(Lat1dateC)) %>%
select(Traitm, Lat1dateC, Lat1dateM) %>%
rename(birth = Lat1dateC, death = Lat1dateM)
inflos_lat2 <- inflos_floraison %>% filter(!is.na(Lat2dateC)) %>%
select(Traitm, Lat2dateC, Lat2dateM) %>%
rename(birth = Lat2dateC, death = Lat2dateM)
inflos_lat3 <- inflos_floraison %>% filter(!is.na(Lat3dateC)) %>%
select(Traitm, Lat3dateC, Lat3dateM) %>%
rename(birth = Lat3dateC, death = Lat3dateM)
inflos_lat4 <- inflos_floraison %>% filter(!is.na(Lat4dateC)) %>%
select(Traitm, Lat4dateC, Lat4dateM) %>%
rename(birth = Lat4dateC, death = Lat4dateM)
inflos_lat5 <- inflos_floraison %>% filter(!is.na(Lat5dateC)) %>%
select(Traitm, Lat5dateC, Lat5dateM) %>%
rename(birth = Lat5dateC, death = Lat5dateM)
floraison2017 <- rbind(inflos_apic, inflos_lat1, inflos_lat2,
inflos_lat3, inflos_lat4, inflos_lat5) %>%
arrange(birth)
floraison2017_ER <- floraison2017 %>% filter(Traitm == "ER")
floraison2017_PS <- floraison2017 %>% filter(Traitm == "PS")
floraison2017_EH <- floraison2017 %>% filter(Traitm == "EH")
date <- floraison2017 %$% unique(c(birth, death)) %>% na.omit
date <- min(date):max(date) %>% as_date
inflos_floraison_ER <- rep(NA, length(date))
inflos_floraison_PS <- rep(NA, length(date))
inflos_floraison_EH <- rep(NA, length(date))
inflos_floraison_all <- rep(NA, length(date))
alive <- rep(NA, length(date))
dead <- rep(NA, length(date))
alive_ER <- rep(NA, length(date))
alive_PS <- rep(NA, length(date))
alive_EH <- rep(NA, length(date))
for (day in 1:length(date)) {
inflos_floraison_ER[day] <- floraison2017_ER %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_PS[day] <- floraison2017_PS %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_EH[day] <- floraison2017_EH %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_all[day] <- floraison2017 %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
alive[day] <- floraison2017 %$% which(birth == date[day]) %>% na.omit %>% length
dead[day] <- floraison2017 %$% which(death == date[day]) %>% na.omit %>%  length
alive_ER[day] <- floraison2017_ER %$% which(birth == date[day]) %>% na.omit %>%  length
alive_PS[day] <- floraison2017_PS %$% which(birth == date[day]) %>% na.omit %>%  length
alive_EH[day] <- floraison2017_EH %$% which(birth == date[day]) %>% na.omit %>%  length
}
floraison_ER <- cbind(date, inflos = inflos_floraison_ER) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "ER")
floraison_ER %>% ggplot(aes(x = date, y = inflos))
floraison_ER %>% ggplot(aes(x = date, y = inflos)) + geom_line()
inflos_floraison <- read_csv2("raw/floraison0.csv")
inflos_floraison %<>% mutate_at(c("ApdateC", "ApdateM",
c(paste0("Lat",1:5,"dateC"),
paste0("Lat", 1:5, "dateM"))), dmy) %>%
filter(Annee == 2017) %>%
filter(Bloc == 1)
inflos_floraison$Traitm[which(inflos_floraison$Traitm == "Sn")] <- "ER"
inflos_floraison$Traitm[which(inflos_floraison$Traitm == "B")] <- "PS"
inflos_floraison$Traitm[which(inflos_floraison$Traitm == "E")] <- "EH"
# Mise en forme inflo floraison -------------------------------------------
inflos_apic <- inflos_floraison %>% filter(!is.na(ApdateC)) %>%
select(Traitm, ApdateC, ApdateM) %>%
rename(birth = ApdateC, death = ApdateM)
inflos_lat1 <- inflos_floraison %>% filter(!is.na(Lat1dateC)) %>%
select(Traitm, Lat1dateC, Lat1dateM) %>%
rename(birth = Lat1dateC, death = Lat1dateM)
inflos_lat2 <- inflos_floraison %>% filter(!is.na(Lat2dateC)) %>%
select(Traitm, Lat2dateC, Lat2dateM) %>%
rename(birth = Lat2dateC, death = Lat2dateM)
inflos_lat3 <- inflos_floraison %>% filter(!is.na(Lat3dateC)) %>%
select(Traitm, Lat3dateC, Lat3dateM) %>%
rename(birth = Lat3dateC, death = Lat3dateM)
inflos_lat4 <- inflos_floraison %>% filter(!is.na(Lat4dateC)) %>%
select(Traitm, Lat4dateC, Lat4dateM) %>%
rename(birth = Lat4dateC, death = Lat4dateM)
inflos_lat5 <- inflos_floraison %>% filter(!is.na(Lat5dateC)) %>%
select(Traitm, Lat5dateC, Lat5dateM) %>%
rename(birth = Lat5dateC, death = Lat5dateM)
floraison2017 <- rbind(inflos_apic, inflos_lat1, inflos_lat2,
inflos_lat3, inflos_lat4, inflos_lat5) %>%
arrange(birth)
# write.csv(floraison2017, file = "2017_floraison_not_corrected.csv")
floraison2017_ER <- floraison2017 %>% filter(Traitm == "ER")
floraison2017_PS <- floraison2017 %>% filter(Traitm == "PS")
floraison2017_EH <- floraison2017 %>% filter(Traitm == "EH")
date <- floraison2017 %$% unique(c(birth, death)) %>% na.omit
date <- min(date):max(date) %>% as_date
inflos_floraison_ER <- rep(NA, length(date))
inflos_floraison_PS <- rep(NA, length(date))
inflos_floraison_EH <- rep(NA, length(date))
inflos_floraison_all <- rep(NA, length(date))
alive <- rep(NA, length(date))
dead <- rep(NA, length(date))
alive_ER <- rep(NA, length(date))
alive_PS <- rep(NA, length(date))
alive_EH <- rep(NA, length(date))
for (day in 1:length(date)) {
inflos_floraison_ER[day] <- floraison2017_ER %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_PS[day] <- floraison2017_PS %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_EH[day] <- floraison2017_EH %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_all[day] <- floraison2017 %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
alive[day] <- floraison2017 %$% which(birth == date[day]) %>% na.omit %>% length
dead[day] <- floraison2017 %$% which(death == date[day]) %>% na.omit %>%  length
alive_ER[day] <- floraison2017_ER %$% which(birth == date[day]) %>% na.omit %>%  length
alive_PS[day] <- floraison2017_PS %$% which(birth == date[day]) %>% na.omit %>%  length
alive_EH[day] <- floraison2017_EH %$% which(birth == date[day]) %>% na.omit %>%  length
}
floraison_ER <- cbind(date, inflos = inflos_floraison_ER) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "ER")
floraison_PS <- cbind(date, inflos = inflos_floraison_PS) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "PS")
floraison_EH <- cbind(date, inflos = inflos_floraison_EH) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "EH")
floraison_EH %>% ggplot(aes(x = date, y = inflos)) + geom_line()
write.csv(floraison2017, file = "2017_floraison_not_corrected.csv")
floraison_EH
floraison_ER
floraison_EH
floraison_PS
floraison_EH
inflos_floraison
inflos_floraison$ApdateC
inflos_floraison$ApdateC %>% class
# Mise en forme inflo floraison -------------------------------------------
inflos_apic <- inflos_floraison %>% filter(!is.na(ApdateC)) %>%
select(Traitm, ApdateC, ApdateM) %>%
rename(birth = ApdateC, death = ApdateM)
inflos_lat1 <- inflos_floraison %>% filter(!is.na(Lat1dateC)) %>%
select(Traitm, Lat1dateC, Lat1dateM) %>%
rename(birth = Lat1dateC, death = Lat1dateM)
inflos_lat2 <- inflos_floraison %>% filter(!is.na(Lat2dateC)) %>%
select(Traitm, Lat2dateC, Lat2dateM) %>%
rename(birth = Lat2dateC, death = Lat2dateM)
inflos_lat3 <- inflos_floraison %>% filter(!is.na(Lat3dateC)) %>%
select(Traitm, Lat3dateC, Lat3dateM) %>%
rename(birth = Lat3dateC, death = Lat3dateM)
inflos_lat4 <- inflos_floraison %>% filter(!is.na(Lat4dateC)) %>%
select(Traitm, Lat4dateC, Lat4dateM) %>%
rename(birth = Lat4dateC, death = Lat4dateM)
inflos_lat5 <- inflos_floraison %>% filter(!is.na(Lat5dateC)) %>%
select(Traitm, Lat5dateC, Lat5dateM) %>%
rename(birth = Lat5dateC, death = Lat5dateM)
floraison2017 <- rbind(inflos_apic, inflos_lat1, inflos_lat2,
inflos_lat3, inflos_lat4, inflos_lat5) %>%
arrange(birth)
floraison2017$birth <- floraison2017$birth - 365
floraison2017$death <- floraison2017$death - 365
# write.csv(floraison2017, file = "2017_floraison_not_corrected.csv")
floraison2017_ER <- floraison2017 %>% filter(Traitm == "ER")
floraison2017_PS <- floraison2017 %>% filter(Traitm == "PS")
floraison2017_EH <- floraison2017 %>% filter(Traitm == "EH")
date <- floraison2017 %$% unique(c(birth, death)) %>% na.omit
date <- min(date):max(date) %>% as_date
inflos_floraison_ER <- rep(NA, length(date))
inflos_floraison_PS <- rep(NA, length(date))
inflos_floraison_EH <- rep(NA, length(date))
inflos_floraison_all <- rep(NA, length(date))
alive <- rep(NA, length(date))
dead <- rep(NA, length(date))
alive_ER <- rep(NA, length(date))
alive_PS <- rep(NA, length(date))
alive_EH <- rep(NA, length(date))
for (day in 1:length(date)) {
inflos_floraison_ER[day] <- floraison2017_ER %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_PS[day] <- floraison2017_PS %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_EH[day] <- floraison2017_EH %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
inflos_floraison_all[day] <- floraison2017 %$% which(birth <= date[day] & death > date[day]) %>%
length + floraison2017_ER %$% which(birth <= date[day] & is.na(death)) %>% length
# alive[day] <- floraison2017 %$% which(birth == date[day]) %>% na.omit %>% length
# dead[day] <- floraison2017 %$% which(death == date[day]) %>% na.omit %>%  length
# alive_ER[day] <- floraison2017_ER %$% which(birth == date[day]) %>% na.omit %>%  length
# alive_PS[day] <- floraison2017_PS %$% which(birth == date[day]) %>% na.omit %>%  length
# alive_EH[day] <- floraison2017_EH %$% which(birth == date[day]) %>% na.omit %>%  length
}
floraison_ER <- cbind(date, inflos = inflos_floraison_ER) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "ER")
floraison_PS <- cbind(date, inflos = inflos_floraison_PS) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "PS")
floraison_EH <- cbind(date, inflos = inflos_floraison_EH) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "EH")
floraison_all <- cbind(date, inflos = inflos_floraison_all) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
filter(date >= "2017-07-18") %>%
mutate(Sol = "all")
floraison_all
floraison <- rbind(floraison_ER, floraison_PS, floraison_EH, floraison_all)
write.csv(floraison, file = "2017_floraison_not_corrected.csv")
