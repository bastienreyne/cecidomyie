## Script qui simule des inflos C/D/E pour le bloc 2
## Utilise les débourrements observés pour ER et PS
## Utilise les débourrements simulés pour EH


# Packages / data ---------------------------------------------------------

library(tidyverse)
bursts_dataset1 <- read.csv("2017_bursts_echelle_bloc2.csv")

## Débourrements simulés
burstER <- c(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.537499580281068, 4.46415953514225,
             5.104755029973203, 5.6938509437371705, 2.237235950936002, 2.2971219729723,
             1.6253951722486635, 0.0, 10.054878666656414, 12.48289331975112, 12.719646729576468,
             12.893661180972629, 13.029163747695913, 11.565524110923207, 11.609008762258965,
             10.351107082642411, 10.382084303239006, 10.356384699216841, 10.296071128162238,
             26.559657641098802, 26.879589247827873, 26.91185661930476, 32.563599029142495, 
             32.618242772745035, 32.78586563874468, 32.71770788924504, 32.96936797950349, 
             123.58213367407203, 125.9683404961959, 118.81689568044791, 21.13395657864721, 0.0,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)
burstPS <- c(396.56143227012996, 403.05197060499347, 50.21249495084049, 45.550177969347565,
             48.59202611050487, 50.30353008373233, 53.58420695909227, 97.25070981305983, 
             99.78816094569228, 102.05944192305023, 104.03787255579043, 106.00098473484417, 
             107.35789341213875, 109.63016986216498, 210.01588892388153, 214.6868604173099,
             210.12804789811145, 214.45008388512537, 219.73011303103948, 221.89879203474865, 
             224.07030656375716, 225.4689974087309, 227.71498532646513, 229.74271536052257,
             232.11248424850706, 235.16570556622722, 237.1767699559747, 199.56701438559082, 
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 33.796623363429816, 77.22047234786142, 
             73.75895644093958, 23.199490258115585, 18.469324874398463, 15.018432340898533,
             4.464278212613916, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)
burstEH <- c(471.7856821555441, 476.8363343841729, 38.477874676322315, 31.195077556589958, 
             32.61728624457411, 33.62857699603232, 36.062512463825044, 13.202287383754856,
             14.068575994832942, 14.95404941531278, 16.35079092775385, 17.75097559989176,
             19.18028931087402, 20.651590640986687, 61.79262438970993, 63.943931223223075,
             66.63474711949505, 68.06829041063271, 69.16330034821578, 70.52854073561053, 
             74.16216291617394, 37.76010498227222, 38.252548211344426, 36.988410668739256, 
             37.78913252455768, 38.147086352790694, 39.1387827995362, 39.05210340257319,
             40.302130017702964, 371.84130682561215, 202.82039739586406, 0.0, 0.0, 0.0, 0.0,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 7.457441583560382,
             36.98248665955345)
## Débourrements obs
burstEHobs <- bursts_dataset1$burstEH


# Simulation --------------------------------------------------------------

mu <- 29
sigma <- 14
CDF_norm <- pnorm(1:50, mu, sigma)

inflosCDE <- function(burst) {
    inflos <- rep(NA, length(burst))
    inflos[1] <- burst[1]
    days <- 1:(length(burst)+3) ## Pour arriver au 80 jours avec les burst du dataset 1
    for (t in days[-1]) {
        temp <- 0
        for (j in 1:min(16, t-1)) {
            temp <- temp + burst[t-j] * (1 - CDF_norm[j]) 
        } 
        inflos[t] <- burst[t] + temp
    }
    inflos
}


inflosCDE_ER <- inflosCDE(burstER)
inflosCDE_PS <- inflosCDE(burstPS)
inflosCDE_EH <- inflosCDE(burstEH)
inflosCDE_EHobs <- inflosCDE(burstEHobs)

ind <- which(bursts_dataset1$date == "2017-07-19")

inflosCDE_bloc2 <- cbind(inflosCDE_ER[1:80],
                         inflosCDE_PS[1:80],
                         inflosCDE_EH[1:80])

# write.csv(inflosCDE_bloc2, file = "2017_inflosCDE_bloc2.csv")
