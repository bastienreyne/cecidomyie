## longueur moyenne des jours par mois
# par ordre chronologique de janvier ? d?cembre
durjour <- c(792.7742,  766.5714 , 732.6774,  697.9667  ,669.1935 , 654.9333,  661.4194 , 685.7742,  718.6333,  753.7097,  784.5667 , 800.7419)
# Ne prend que les expe en laboratoire
eme11L.df <- eme11.df[eme11.df$cond=="L" ,]
# Colonne Pourcentage de diapause (diapause sur nombre total de larves mispar lot)
eme11L.df$Pct <- eme11L.df$totlarviv/(eme11L.df$nblarv)
# Colonne Mois
eme11L.df$mois <- substr(eme11L.df$boite,1,3)
eme11L.df$mois <- as.factor(as.character(eme11L.df$mois))
levels(eme11L.df$mois) <- c("juin11","juil11","aout11","sept11","janv12","fev12","mars12","avr12","avr12","juin12")
# Fichier du type Data_diapause11
str(eme11L.df)
#############
# Graphique barplot pour article
attach(eme11L.df)
tete <- as.data.frame(cbind(pour=tapply(totlarviv,mois,sum),nb=tapply(nblarv,mois,sum)))
tete <- rbind(tete[1:4,],as.data.frame(cbind(pour=rep(0,3),nb=rep(0,3))),tete[5:8,],as.data.frame(cbind(pour=c(0),nb=c(0))),tete[9,])
tete$num <- (tete$pour/tete$nb)*(1-tete$pour/tete$nb)
tete$errstd <- sqrt(tete$num/tete$nb)
tete$mois <- row.names(tete)
par(mar=c(3, 4, 1, 6),cex=1.1)
barplot2(tete$pour/tete$nb,plot.ci=T,ci.u=(tete$pour/tete$nb)+2*tete$errstd,ci.l=(tete$pour/tete$nb)-2*tete$errstd,
ylim=c(-.02,0.49),names.arg =c("June","July","August","September","","","","Juanary","February","March","April","","June"),
xlab="Month",ylab="Rate of larvae into diapause")
legend(0,0.4,c("Temperature","Daylength"),lty=c(1,10),pch=c(1,8,9),bty="n")
j <- 0
for (i in c(1:4,8:11,13) )
{
j <- j+1
valeur <- c("d","d","c","d","ab","a","b","c","c")
ypos  <- seq(0.7,20,1.2)
text(ypos[i],0.487,valeur[j])
}
j <- 0
for (i in c(1:4,8:11,13) )
{
j <- j+1
valeur <- tapply(nblarv,mois,sum)
ypos  <- seq(0.7,20,1.2)
text(ypos[i],-0.01,valeur[j])
}
text(0,-0.01,"n =")
# rajoute la temperature
par(new=T)
yy <- tapply(temp.df$tempm,paste(temp.df$mois,temp.df$an),mean,na.rm=T)[c(9,7,1,17,15,13,4,6,5,12,3,11,10)]
plot(c(0.5:12.5),yy,ylim=c(17,26),xlim=c(0,13),axes=F,xlab="",ylab="",type="b")
axis(4,line=-1)
mtext("Temperature (?c)", 4,adj=0.5,line=1)
source('~/cecidomyie/dataPaul_Article diapause/SuiviR_data2.r')
eme11.df
temp.df
install.packages("agricolae")
source('~/cecidomyie/dataPaul_Article diapause/SuiviR_data2.r')
rm(list = ls())
source('~/cecidomyie/dataPaul_Article diapause/SuiviR_data3.r')
source('~/cecidomyie/dataPaul_Article diapause/SuiviR_data3.r')
source('~/cecidomyie/dataPaul_Article diapause/SuiviR_data2.r')
par(mfrow = c(1, 1))
source('~/cecidomyie/dataPaul_Article diapause/SuiviR_data2.r')
eme11.df
eme11.df <- read.table("data2.txt", header = T, sep = "\t")
eme11.df
tete <- as.data.frame(cbind(
pour = tapply(totlarviv, mois, sum),
nb = tapply(nblarv, mois, sum)
))
tete <-
rbind(tete[1:4,],
as.data.frame(cbind(
pour = rep(0, 3), nb = rep(0, 3)
)),
tete[5:8,],
as.data.frame(cbind(pour = c(0), nb = c(0))),
tete[9,])
tete$num <- (tete$pour / tete$nb) * (1 - tete$pour / tete$nb)
tete$errstd <- sqrt(tete$num / tete$nb)
tete$mois <- row.names(tete)
par(mar = c(3, 4, 1, 6), cex = 1.1)
barplot2(
tete$pour / tete$nb,
plot.ci = T,
ci.u = (tete$pour / tete$nb) + 2 * tete$errstd,
ci.l = (tete$pour / tete$nb) - 2 * tete$errstd,
ylim = c(-.02, 0.49),
names.arg = c(
"June",
"July",
"August",
"September",
"",
"",
"",
"Juanary",
"February",
"March",
"April",
"",
"June"
),
xlab = "Month",
ylab = "Rate of larvae into diapause"
)
tete$pour
tete$pour / tete$nb
eme11.df
?tapply
mois
source('~/cecidomyie/dataPaul_Article diapause/SuiviR_data2.r')
eme11L.df
eme11L.df$toteme / eme11L.df$nblarv
eme11L.df$toteme / eme11L.df$nblarv %>% mean()
library(tidyverse)
eme11L.df$toteme / eme11L.df$nblarv %>% mean()
eme11L.df$toteme / eme11L.df$nblarv
mean(eme11L.df$toteme / eme11L.df$nblarv)
temp.df
temp.df$mois
eme11.df
eme11.df$datprelev
eme11.df$datprelev %>% unique
?aggregate
library(tidyverse)
aggregate(eme11.df$nblarv, eme11.df$datprelev, sum)
aggregate(eme11.df$nblarv, list(eme11.df$datprelev), sum)
eme11.df %>% filter(datprelev == "21/07/2011")
nb_larves <- aggregate(larves$nblarv, list(larves$dateprelev), sum)$x
larves <- read.table("data2.txt", header = T, sep = "\t")
temp <- read.table("data2_meteo.txt", header = T, sep = "\t")
nb_larves <- aggregate(larves$nblarv, list(larves$dateprelev), sum)$x
nb_larves <- aggregate(eme11.df$nblarv, list(eme11.df$datprelev), sum)$x
nb_larves <- aggregate(larves$nblarv, list(larves$datprelev), sum)$x
nb_larves
nb_larves <- aggregate(larves$nblarv, list(larves$datprelev), sum)$x
rm(list = ls())
larves <- read.table("data2.txt", header = T, sep = "\t")
temp <- read.table("data2_meteo.txt", header = T, sep = "\t")
nb_larves <- aggregate(larves$nblarv, list(larves$datprelev), sum)$x
nb_pup <- aggregate(larves$toteme, list(larves$datprelev), sum)$x
nb_pup / nb_larves
nb_pup
larves
larves$toteme
df_tmp <- data.frame(larves$datprelev, larves$toteme)
df_tmp
df_tmp %>% na.omit
df_tmp <- data.frame(date = larves$datprelev, pup = larves$toteme) %>% na.omit
nb_pup <- aggregate(df_tmp$pup, list(df_tmp$date), sum)$x
nb_pup
nb_larves <- aggregate(larves$nblarv, list(larves$datprelev), sum)
df_tmp <- data.frame(date = larves$datprelev, pup = larves$toteme) %>% na.omit
nb_larves
nb_pup
nb_pup <- aggregate(df_tmp$pup, list(df_tmp$date), sum)
nb_pup
nb_larves$Group.1 %notin% nb_pup$Group.1
nb_larves$Group.1 %not_in% nb_pup$Group.1
nb_pup$Group.1 %in% nb_larves
nb_pup$Group.1 %in% nb_larves$Group.1
nb_larves$Group.1 %in% nb_pup$Group.1
nb_larves$Group.1 %ni% nb_pup$Group.1
nb_larves$Group.1 %in% nb_pup$Group.1
## Gardons uniquement les dates où l'on connaît le nombre de pupes
good_dates <- nb_larves$Group.1 %in% nb_pup$Group.1
good_dates
nb_larves[good_dates, ]
nb_larves[good_dates, ] %>% nrow
nb_pup %>% nrow
pct_pup <- nb_pup$x / nb_larves[good_dates, ]$x
pct_pup
plot(good_dates, pct_pup)
plot(nb_pup$Group.1, pct_pup)
nb_pup$Group.1 %>% class
nb_pup$Group.1
nb_pup$Group.1 %>% as.Date()
library(lubridate)
nb_pup$Group.1 %>% dmy
library(lubridate)
to_plot <- data.frame(date = nb_pup$Group.1 %>% dmy,
pct = pct_pup)
to_plot %>% ggplot +
aes(x = date, y = pct) +
geom_point() +
theme_bw()
temp
temp %>% date()
temp$date
moving_mean <- function(x) {
n_x <- length(x)
ans <- rep(NA, n_x)
ans[2:(n_x - 1)] <- x[1:(n_x-2)] + x[2:(n_x - 1)] + x[3:n_x]
ans[1] <- 2 * x[1] + x[2]
ans[n_x] <- x[(n_x - 1)] + 2 * x[n_x]
ans / 3
}
temperature <- moving_mean(temp$tempm)
temperature
temp$date
temp$date %in% nb_pup$Group.1
which(temp$date %in% nb_pup$Group.1)
good_ind <- which(temp$date %in% nb_pup$Group.1)
temperature[good_ind]
temp$tempm[good_ind]
good_temp <- temperature[good_ind]
which(is.na(good_temp))
good_temp[which(is.na(good_temp))] <- temp$tempm[which(is.na(good_temp))]
good_temp
temperature <- moving_mean(temp$tempm)
good_ind <- which(temp$date %in% nb_pup$Group.1)
good_temp <- temperature[good_ind]
good_temp[which(is.na(good_temp))] <- temp$tempm[which(is.na(good_temp))]
good_temp
temp$tempm[which(is.na(good_temp))]
temp$tempm[good_ind][which(is.na(good_temp))]
good_temp[which(is.na(good_temp))] <- temp$tempm[good_ind][which(is.na(good_temp))]
good_temp
lm(pct_pup ~ good_temp)
plot(good_temp, pct_pup)
fit <- lm(pct_pup ~ good_temp)
summary(fit)
good_dates
pct_pup
nb_pup$Group.1
nb_pup$Group.1 %>% dmy
nb_pup$Group.1 %>% dmy %>% order()
pct_pup[nb_pup$Group.1 %>% dmy %>% order()]
good_ordre <- nb_pup$Group.1 %>% dmy %>% order()
plot(good_temp, pct_pup[good_ordre])
good_pct <- pct_pup[good_ordre]
fit <- lm(good_pct ~ good_temp)
summary(fit)
to_plot2 <- data.frame(pup = good_pct, temp = good_temp)
to_plot2 %>% ggplot +
aes(x = temp, y = pup) +
geom_point +
stat_smooth(method = "lm") +
theme_bw() +
ylab("Taux de pupaison") +
xlab("Température")
to_plot2 %>% ggplot +
aes(x = temp, y = pup) +
geom_point() +
stat_smooth(method = "lm") +
theme_bw() +
ylab("Taux de pupaison") +
xlab("Température")
summary(fit2)
summary(fit)
fit[1]
fit$coefficients[1]
to_plot2 %>% ggplot +
aes(x = temp, y = pup) +
geom_point() +
geom_abline(intercept = fit$coefficients[1], slope = fit$coefficients[2]) +
theme_bw() +
ylab("Taux de pupaison") +
xlab("Température")
library(xtable)
xtable(fit)
ggsave("lm.eps")
source('~/cecidomyie/dataPaul_Article diapause/SuiviR_data1.r')
test
# Piege sans inflorescence ni pousse vegetative recente
m  <- tapply(data2.df[data2.df$Intro=="A",]$Nbad,data2.df[data2.df$Intro=="A",]$Sem,mean)
sd <- tapply(data2.df[data2.df$Intro=="A",]$Nbad,data2.df[data2.df$Intro=="A",]$Sem,sd)
sd <- replace(rep(0,max(as.numeric(names(sd)))),as.numeric(names(sd)),sd)
test <- replace(rep(0,max(as.numeric(names(m)))),as.numeric(names(m)),m)
names(test) <-  c(29:52,1:52)[1:length(test)]
barplot2(log10(test+1),plot.ci=T,ci.u=log10(test+sd+1),ci.l=log10(test+1),xlab="",ylab="",ylim=c(0,2.5))
text(75,2,"A",cex=3)
abline(v=29,lty=2)
text(25,2.2,"2011",cex=1.8)
text(33,2.2,"2012",cex=1.8)
test
mXX
nXX
xXX
mXX
test
m  <- tapply(data2.df[data2.df$Intro=="A",]$Nbad,data2.df[data2.df$Intro=="A",]$Sem,mean)
sd <- tapply(data2.df[data2.df$Intro=="A",]$Nbad,data2.df[data2.df$Intro=="A",]$Sem,sd)
sd <- replace(rep(0,max(as.numeric(names(sd)))),as.numeric(names(sd)),sd)
test <- replace(rep(0,max(as.numeric(names(m)))),as.numeric(names(m)),m)
names(test) <-  c(29:52,1:52)[1:length(test)]
test
mXX
data1 <- c(8.3333333, 12.0000000, 5.3333333, 0.6666667, 0.3333333, 1.3333333, 0.3333333,
1.3333333, 1.6666667, 1.0000000, 0.3333333, 1.3333333, 0.3333333, 0.3333333)
temp1 <- c(21.45000, 21.10000, 20.77143, 20.92857, 21.48571, 20.31429, 21.18571,
21.12857, 21.45714, 21.84286, 21.41429, 22.20000, 21.81429, 22.54286)
data2 <- c(6.3333333, 10.3333333, 0.6666667, 2.3333333, 1.3333333, 2.3333333, 2.3333333,
1.0000000, 2.0000000, 0.3333333, 0.6666667, 0.3333333)
temp2 <- c(20.31667, 20.84286, 22.05714, 21.22857, 21.25714, 21.45714, 21.44286, 20.80000,
20.86667, 21.24286, 21.35000, 21.57143)
plot(temp1, data1)
par(mfrow = c(1, 1))
plot(temp1, data1)
plot(temp2, data2)
plot(data1)
plot(data1, type = "l")
lm(data1 ~ temp1)
summary(lm(data1 ~ temp1))
summary(lm(data2 ~ temp2))
plot(temp2, data2)
temp
test
# Piege sans inflorescence ni pousse vegetative recente
m  <- tapply(data2.df[data2.df$Intro=="A",]$Nbad,data2.df[data2.df$Intro=="A",]$Sem,mean)
sd <- tapply(data2.df[data2.df$Intro=="A",]$Nbad,data2.df[data2.df$Intro=="A",]$Sem,sd)
sd <- replace(rep(0,max(as.numeric(names(sd)))),as.numeric(names(sd)),sd)
test <- replace(rep(0,max(as.numeric(names(m)))),as.numeric(names(m)),m)
names(test) <-  c(29:52,1:52)[1:length(test)]
test
mXX
mXX["29"]
library(tidyverse)
data.frame(temp = temp1, data = data1) %>%
ggplot +
aes(x = temp, y = data) +
geom_point() +
theme_bw()
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes(x = temp, y = data) +
geom_point() +
theme_bw()
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes(y = data) +
geom_bar() +
theme_bw()
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes() +
geom_bar() +
theme_bw()
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes(x = data) +
geom_bar() +
theme_bw()
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes(x = data) +
geom_bar(stat = "identity") +
theme_bw()
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes(y = data) +
geom_bar(stat = "identity") +
theme_bw()
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes(x = 29:42, y = data) +
geom_bar(stat = "identity") +
theme_bw()
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes(x = 29:41, y = data) +
geom_bar(stat = "identity") +
theme_bw()
29+12
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes(x = 29:40, y = data) +
geom_bar(stat = "identity") +
theme_bw()
plot(rpois(1000))
plot(rpois(1000, lambda = 1))
hist(rpois(1000, lambda = 1))
hist(rpois(10000, lambda = 1))
hist(rpois(100000, lambda = 1))
geom_hist(data = data.frame(pois = rpois(n = 1000, lambda = 1)))
geom_histogram(data = data.frame(pois = rpois(n = 1000, lambda = 1)))
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes(x = 29:40, y = data) +
geom_bar(stat = "identity") +
theme_bw() +
geom_histogram(data = data.frame(pois = rpois(n = 1000, lambda = 1)))
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes(x = 29:40, y = data) +
geom_bar(stat = "identity") +
theme_bw() +
geom_histogram(data = data.frame(pois = rpois(n = 1000, lambda = 1)), aes(x = 1:1000))
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes(x = 29:40, y = data) +
geom_bar(stat = "identity") +
theme_bw()
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes(x = 1:10, y = data) +
geom_bar(stat = "identity") +
theme_bw()
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes(x = 1:12, y = data) +
geom_bar(stat = "identity") +
theme_bw()
pois <- data.frame(poiss = rpois(1000, 1))
data.frame(temp = temp2, data = data2) %>%
ggplot +
aes(x = 1:12, y = data) +
geom_bar(stat = "identity") +
theme_bw() +
geom_density(aes(x = poiss), data = pois)
data.frame(temp = temp2, data = data2) %>%
ggplot +
geom_bar(aes(x = 1:12, y = data), stat = "identity") +
theme_bw() +
geom_density(aes(x = poiss), data = pois)
data.frame(temp = temp2, data = data2) %>%
ggplot +
geom_bar(aes(x = 1:12, y = data), stat = "identity") +
theme_bw() +
geom_density(aes(x = 10 * poiss), data = pois)
data.frame(temp = temp2, data = data2) %>%
ggplot +
geom_bar(aes(x = 1:12, y = data), stat = "identity") +
theme_bw() +
geom_density(aes(x = poiss), data = pois)
pois <- data.frame(poiss = rpois(10000, 1))
data.frame(temp = temp2, data = data2) %>%
ggplot +
geom_bar(aes(x = 1:12, y = data), stat = "identity") +
theme_bw() +
geom_density(aes(x = poiss), data = pois)
data.frame(temp = temp2, data = data2) %>%
ggplot +
geom_bar(aes(x = 1:12, y = data), stat = "identity") +
theme_bw()
mXX
plot(mXX, type = "l")
vline(x = 29)
?abline
abline(v = 29)
abline(v = 79)
plot(mXX, type = "l")
abline(v = 29-22)
abline(v = 79-22)
plot(mXX, type = "l")
abline(v = 79-22+1)
abline(v = 29-22+1)
plot(moving.mean(mXX), type = "l")
moving_mean <- function(x) {
n_x <- length(x)
ans <- rep(NA, n_x)
ans[2:(n_x - 1)] <- x[1:(n_x-2)] + x[2:(n_x - 1)] + x[3:n_x]
ans[1] <- 2 * x[1] + x[2]
ans[n_x] <- x[(n_x - 1)] + 2 * x[n_x]
ans / 3
}
plot(moving.mean(mXX), type = "l")
plot(moving_mean(mXX), type = "l")
abline(v = 29-22+1)
plot(mXX, type = "l")
abline(v = 29-22+1)
abline(v = 79-22+1)
mXX["28"]
mXX["79"]
mXX["27"]
mXX["78"]
abline(h = 20.5)
density(data1)
plot(density(data1))
plot(density(data2))
plot(density(c(data1, data2)))
source('~/cecidomyie/dataPaul_Article diapause/ppup_temp.R')
plot(fit)
plot(predict(fit))
to_plot2 <- data.frame(pup = good_pct, temp = good_temp)
to_plot2 %>% ggplot +
aes(x = temp, y = pup) +
geom_point() +
geom_abline(intercept = fit$coefficients[1], slope = fit$coefficients[2]) +
theme_bw() +
ylab("Taux de pupaison") +
xlab("Température")
good_temp
temperature
temperature %>% plot
temperature %>% plot(type = "")
temperature %>% plot(type = "l")
good_ind
15-7
15+7
22-8
ength
8:22 %>% length()
temp51j <- rep(NA, length(good_ind))
for (i in 1:length(good_ind)) {
temp51j[i] <- mean(temperature[(good_ind[i] - 7):(good_ind[i] + 7)])
}
temp51j
for (i in 1:length(good_ind)) {
temp51j[i] <- mean(temperature[(good_ind[i] - 7):(good_ind[i] + 7)], na.rm = TRUE)
}
temp51j
plot(temp51j, pct_pup[good_ordre])
fit2 <- lm(good_pct ~ temp15j)
temp15j <- rep(NA, length(good_ind))
for (i in 1:length(good_ind)) {
temp15j[i] <- mean(temperature[(good_ind[i] - 7):(good_ind[i] + 7)], na.rm = TRUE)
}
fit2 <- lm(good_pct ~ temp15j)
fit2
fit2 %>% summary
fit1
fit
fit2
