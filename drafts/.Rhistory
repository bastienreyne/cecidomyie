upper.bounds = c(10,1,1,1,10, 12),
popsize = 100, generations = 50)
ind_opt_tout2 <- res_tout2$value %>% as_tibble %>%
mutate(norm = abs(V1 + V2 + V3 + V4 + V5 + V6)) %$%
which.min(norm)
arg_opt_tout2 <- res_tout2$par[ind_opt_tout2, ]
ltout2 <- dynamics(arg_opt_tout2, bursts)
to_plot_ER <- cbind(Date = date2017,
Observées = larves2017[, 1],
Référence = lref[, 1],
Tout = ltout2[, 1]) %>%
as_tibble %>%
mutate_at("Date", as_date) %>%
gather(Observées, Référence, Tout, key = Toto, value = Nombre) %>%
mutate(Sol = factor("Enherbement ras", levels = c("Enherbement ras",
"Paillage synthétique",
"Enherbement haut")))
to_plot_PS <- cbind(Date = date2017,
Observées = larves2017[, 2],
Référence = lref[, 2],
Tout = ltout2[, 2]) %>%
as_tibble %>%
mutate_at("Date", as_date) %>%
gather(Observées, Référence, Tout, key = Toto, value = Nombre) %>%
mutate(Sol = factor("Paillage synthétique", levels = c("Enherbement ras",
"Paillage synthétique",
"Enherbement haut")))
to_plot_EH <- cbind(Date = date2017,
Observées = larves2017[, 3],
Référence = lref[, 3],
Tout = ltout2[, 3]) %>%
as_tibble %>%
mutate_at("Date", as_date) %>%
gather(Observées, Référence, Tout, key = Toto, value = Nombre) %>%
mutate(Sol = factor("Enherbement haut", levels = c("Enherbement ras",
"Paillage synthétique",
"Enherbement haut")))
to_plot <- bind_rows(to_plot_ER, to_plot_PS, to_plot_EH)
to_plot %>% ggplot(aes(x = Date, y = Nombre, color = Toto)) +
geom_point() +
geom_line() +
theme_bw() +
theme(legend.title = element_blank()) +
facet_wrap(Sol ~ .) +
ylab("Nombre de larves")
source('~/cecidomyie/drafts/plots_simu_sdmin.R')
library(tidyverse)
source('~/cecidomyie/drafts/plots_simu_sdmin.R')
library(lubridate)
source('~/cecidomyie/drafts/plots_simu_sdmin.R')
sdmin_EH
sdmin_ER
sdmin_PS
sdmin_EH
Itsdmin_ER <- ITSDMIN_ER
Itsdmin_PS <- ITSDMIN_PS
Itsdmin_EH <- ITSDMIN_EH
save(Itsdmin_ER, Itsdmin_PS, Itsdmin_EH)
save(Itsdmin_ER, Itsdmin_PS, Itsdmin_EH, file = "Itsdmin.Rdata")
load("Itsdmin.Rdata")
sdmin <- cbind(Itsdmin_ER, Itsdmin_PS, Itsdmin_EH)
sdmin
to_plot %>% ggplot(aes(x = Date, y = Nombre, color = Toto)) +
geom_point() +
geom_line() +
theme(legend.title = element_blank()) +
facet_wrap(Sol ~ .) +
ylab("Nombre de larves")
source('~/cecidomyie/drafts/effets.R')
source('~/cecidomyie/model_R/model.R')
# Attractives sdmin -------------------------------------------------------
res_asd <- nsga2(objectif, 5, 3, my_mae, simulated,
lower.bounds = rep(0,5),
upper.bounds = c(10,1,1,1,10),
popsize = 100, generations = 50)
ind_opt_asd <- res_asd$value %>% as_tibble %>%
mutate(norm = abs(V1 + V2 + V3)) %$%
which.min(norm)
arg_opt_asd <- res_asd$par[ind_opt_asd, ]
lasd <- dynamics2(arg_opt_asd, simulated)
to_plot_ER <- cbind(Date = date2017,
Observées = larves2017[, 1],
Référence = lref[, 1],
`Inflos attractives` = lasd[, 1]) %>%
as_tibble %>%
mutate_at("Date", as_date) %>%
gather(Observées, Référence, `Inflos attractives`, key = Toto, value = Nombre) %>%
mutate(Sol = factor("Enherbement ras", levels = c("Enherbement ras",
"Paillage synthétique",
"Enherbement haut")))
to_plot_PS <- cbind(Date = date2017,
Observées = larves2017[, 2],
Référence = lref[, 2],
`Inflos attractives` = lasd[, 2]) %>%
as_tibble %>%
mutate_at("Date", as_date) %>%
gather(Observées, Référence, `Inflos attractives`, key = Toto, value = Nombre) %>%
mutate(Sol = factor("Paillage synthétique", levels = c("Enherbement ras",
"Paillage synthétique",
"Enherbement haut")))
to_plot_EH <- cbind(Date = date2017,
Observées = larves2017[, 3],
Référence = lref[, 3],
`Inflos attractives` = lasd[, 3]) %>%
as_tibble %>%
mutate_at("Date", as_date) %>%
gather(Observées, Référence, `Inflos attractives`, key = Toto, value = Nombre) %>%
mutate(Sol = factor("Enherbement haut", levels = c("Enherbement ras",
"Paillage synthétique",
"Enherbement haut")))
to_plot <- bind_rows(to_plot_ER, to_plot_PS, to_plot_EH)
to_plot %>% ggplot(aes(x = Date, y = Nombre, color = Toto)) +
geom_point() +
geom_line() +
theme(legend.title = element_blank()) +
facet_wrap(Sol ~ .) +
ylab("Nombre de larves")
to_plot %>% ggplot(aes(x = Date, y = Nombre, color = Toto)) +
geom_point() +
geom_line() +
theme_bw() +
theme(legend.title = element_blank()) +
facet_wrap(Sol ~ .) +
ylab("Nombre de larves")
arg_opt_asd
lasd
sdmin
# Attractives sdmin -------------------------------------------------------
res_asd <- nsga2(objectif, 5, 3, my_mae, sdmin,
lower.bounds = rep(0,5),
upper.bounds = c(10,1,1,1,10),
popsize = 100, generations = 50)
ind_opt_asd <- res_asd$value %>% as_tibble %>%
mutate(norm = abs(V1 + V2 + V3)) %$%
which.min(norm)
arg_opt_asd <- res_asd$par[ind_opt_asd, ]
lasd <- dynamics2(arg_opt_asd, simulated)
to_plot_ER <- cbind(Date = date2017,
Observées = larves2017[, 1],
Référence = lref[, 1],
`Inflos attractives` = lasd[, 1]) %>%
as_tibble %>%
mutate_at("Date", as_date) %>%
gather(Observées, Référence, `Inflos attractives`, key = Toto, value = Nombre) %>%
mutate(Sol = factor("Enherbement ras", levels = c("Enherbement ras",
"Paillage synthétique",
"Enherbement haut")))
to_plot_PS <- cbind(Date = date2017,
Observées = larves2017[, 2],
Référence = lref[, 2],
`Inflos attractives` = lasd[, 2]) %>%
as_tibble %>%
mutate_at("Date", as_date) %>%
gather(Observées, Référence, `Inflos attractives`, key = Toto, value = Nombre) %>%
mutate(Sol = factor("Paillage synthétique", levels = c("Enherbement ras",
"Paillage synthétique",
"Enherbement haut")))
to_plot_EH <- cbind(Date = date2017,
Observées = larves2017[, 3],
Référence = lref[, 3],
`Inflos attractives` = lasd[, 3]) %>%
as_tibble %>%
mutate_at("Date", as_date) %>%
gather(Observées, Référence, `Inflos attractives`, key = Toto, value = Nombre) %>%
mutate(Sol = factor("Enherbement haut", levels = c("Enherbement ras",
"Paillage synthétique",
"Enherbement haut")))
to_plot <- bind_rows(to_plot_ER, to_plot_PS, to_plot_EH)
to_plot %>% ggplot(aes(x = Date, y = Nombre, color = Toto)) +
geom_point() +
geom_line() +
theme_bw() +
theme(legend.title = element_blank()) +
facet_wrap(Sol ~ .) +
ylab("Nombre de larves")
# Attractives sdmin -------------------------------------------------------
res_asd <- nsga2(objectif, 5, 3, my_mae, sdmin,
lower.bounds = rep(0,5),
upper.bounds = c(10,1,1,1,10),
popsize = 100, generations = 50)
ind_opt_asd <- res_asd$value %>% as_tibble %>%
mutate(norm = abs(V1 + V2 + V3)) %$%
which.min(norm)
arg_opt_asd <- res_asd$par[ind_opt_asd, ]
lasd <- dynamics2(arg_opt_asd, simulated)
to_plot_ER <- cbind(Date = date2017,
Observées = larves2017[, 1],
Référence = lref[, 1],
`Inflos attractives` = lasd[, 1]) %>%
as_tibble %>%
mutate_at("Date", as_date) %>%
gather(Observées, Référence, `Inflos attractives`, key = Toto, value = Nombre) %>%
mutate(Sol = factor("Enherbement ras", levels = c("Enherbement ras",
"Paillage synthétique",
"Enherbement haut")))
to_plot_PS <- cbind(Date = date2017,
Observées = larves2017[, 2],
Référence = lref[, 2],
`Inflos attractives` = lasd[, 2]) %>%
as_tibble %>%
mutate_at("Date", as_date) %>%
gather(Observées, Référence, `Inflos attractives`, key = Toto, value = Nombre) %>%
mutate(Sol = factor("Paillage synthétique", levels = c("Enherbement ras",
"Paillage synthétique",
"Enherbement haut")))
to_plot_EH <- cbind(Date = date2017,
Observées = larves2017[, 3],
Référence = lref[, 3],
`Inflos attractives` = lasd[, 3]) %>%
as_tibble %>%
mutate_at("Date", as_date) %>%
gather(Observées, Référence, `Inflos attractives`, key = Toto, value = Nombre) %>%
mutate(Sol = factor("Enherbement haut", levels = c("Enherbement ras",
"Paillage synthétique",
"Enherbement haut")))
to_plot <- bind_rows(to_plot_ER, to_plot_PS, to_plot_EH)
to_plot %>% ggplot(aes(x = Date, y = Nombre, color = Toto)) +
geom_point() +
geom_line() +
theme_bw() +
theme(legend.title = element_blank()) +
facet_wrap(Sol ~ .) +
ylab("Nombre de larves")
data <- read.csv("../data/2017_piege.csv")
library(tidyverse)
larves
data
# Packages / data ---------------------------------------------------------
library(tidyverse)
data <- read.csv("../data/2017_piege.csv")
larves_ER <- data %>% filter(Sol == "ER") %>% pull(inflos)
larves_PS <- data %>% filter(Sol == "PS") %>% pull(inflos)
larves_EH <- data %>% filter(Sol == "EH") %>% pull(inflos)
?cor
larves_ER %>% lag()
lag(larves_ER, 12)
?lag
lag(larves_ER, 12)[-1:12]
lag(larves_ER, 12)[-(1:12)]
lag(larves_ER, 12)[-(1:12)] %>% length
cor(lag(larves_ER, 12)[-(1:12)], larves_ER[1:68])
cor(lag(larves_PS, 12)[-(1:12)], larves_PS[1:68])
cor(lag(larves_EH, 12)[-(1:12)], larves_EH[1:68])
?cor
cor(lag(larves_ER, 12)[-(1:12)], larves_ER[1:68], method = "spearman")
cor(lag(larves_PS, 12)[-(1:12)], larves_PS[1:68], method = "spearman")
larves_ER[1:68]
larves_ER[12:80]
larves_ER[13:80]
cor(lag(larves_ER, 12)[-(1:12)], larves_ER[13:80], method = "spearman")
cor(lag(larves_ER, 12)[-(1:12)], larves_ER[13:80])
cor(lag(larves_PS, 12)[-(1:12)], larves_PS[13:80])
cor(lag(larves_EH, 12)[-(1:12)], larves_EH[13:80])
cor(lag(larves_EH, 12)[-(1:12)], larves_EH[13:80], method = "spearman")
cor(lag(larves_ER, 12)[-(1:12)], larves_ER[13:80], method = "spearman")
cor(lag(larves_PS, 12)[-(1:12)], larves_PS[13:80], method = "spearman")
cor(lag(larves_EH, 12)[-(1:12)], larves_EH[13:80], method = "spearman")
## 13
cor(lag(larves_ER, 13)[-(1:13)], larves_ER[14:80], method = "spearman")
## 12
cor(lag(larves_ER, 12)[-(1:12)], larves_ER[13:80], method = "spearman")
cor(lag(larves_PS, 12)[-(1:12)], larves_PS[13:80], method = "spearman")
cor(lag(larves_EH, 12)[-(1:12)], larves_EH[13:80], method = "spearman")
## 13
cor(lag(larves_ER, 13)[-(1:13)], larves_ER[14:80], method = "spearman")
cor(lag(larves_PS, 13)[-(1:13)], larves_PS[14:80], method = "spearman")
cor(lag(larves_EH, 13)[-(1:13)], larves_EH[14:80], method = "spearman")
my_mae <- function(x, y) {
n_obs <- length(x)
sum(abs(x - y)) / n_obs
}
objectif_larves <- function(x, larve) {
alpha <- x[1:68]
r <- x[69]
mu <- x[70]
exo <- x[71:138]
larves_lag <- lag(larve, 12)[-(1:12)]
larves_pred <- alpha * R * (mu * larves_lag + exo)
my_mae(larves_pred, larve[13:80])
}
library(mco)
# Modèle ------------------------------------------------------------------
my_mae <- function(x, y) {
n_obs <- length(x)
sum(abs(x - y)) / n_obs
}
objectif_larves <- function(x, larve) {
alpha <- x[1:68]
r <- x[69]
mu <- x[70]
exo <- x[71:138]
larves_lag <- lag(larve, 12)[-(1:12)]
larves_pred <- alpha * R * (mu * larves_lag + exo)
my_mae(larves_pred, larve[13:80])
}
res_ER <- nsga2(objectif_larves, 138, 1, larves_ER,
lower.bounds = rep(0, 138), upper.bounds = rep(6000, 138))
# Modèle ------------------------------------------------------------------
my_mae <- function(x, y) {
n_obs <- length(x)
sum(abs(x - y)) / n_obs
}
objectif_larves <- function(x, larve) {
alpha <- x[1:68]
r <- x[69]
mu <- x[70]
exo <- x[71:138]
larves_lag <- lag(larve, 12)[-(1:12)]
larves_pred <- alpha * r * (mu * larves_lag + exo)
my_mae(larves_pred, larve[13:80])
}
res_ER <- nsga2(objectif_larves, 138, 1, larves_ER,
lower.bounds = rep(0, 138), upper.bounds = rep(6000, 138))
res_ER
res_ER$value
res_ER <- nsga2(objectif_larves, 138, 1, larves_ER,
lower.bounds = rep(0, 138), upper.bounds = rep(6000, 138),
popsize = 4, generations = 800)
res_ER$value
res_ER <- nsga2(objectif_larves, 138, 1, larves_ER,
lower.bounds = rep(0, 138), upper.bounds = rep(6000, 138),
popsize = 400, generations = 800)
res_ER$value
?optim
res_ER <- optim(rep(0, 138), objectif_larves, gr = NULL, larves_ER)
res_ER
res_ER <- optim(rep(0, 138), objectif_larves, gr = NULL, larves_ER)
res_ER
res_ER <- optim(rep(0, 138), objectif_larves, gr = NULL,
larves_ER, method = "BFGS")
res_ER
res_ER <- nsga2(objectif_larves, 138, 1, larves_ER,
lower.bounds = rep(0, 138), upper.bounds = rep(6000, 138),
popsize = 400, generations = 800)
res_ER
res_ER <- nsga2(objectif_larves, 138, 1, larves_ER,
lower.bounds = rep(0, 138), upper.bounds = rep(5000, 138),
popsize = 400, generations = 800)
give <- function(x, larve) {
alpha <- x[1:68]
r <- x[69]
mu <- x[70]
exo <- x[71:138]
larves_lag <- lag(larve, 12)[-(1:12)]
larves_pred <- alpha * r * (mu * larves_lag + exo)
}
give(res_ER$par[1,], larves_ER)
toto <- give(res_ER$par[1,], larves_ER)
toto
plot(toto)
lines(larves_ER[13:80])
res_ER <- nsga2(objectif_larves, 138, 1, larves_ER,
lower.bounds = rep(0, 138), upper.bounds = rep(5000, 138),
popsize = 800, generations = 1500)
give(res_ER$par[1,], larves_ER)
toto <- give(res_ER$par[1,], larves_ER)
plot(toto, type = "l", col = "red")
lines(larves_ER[13:80])
res_ER <- nsga2(objectif_larves, 138, 1, larves_ER,
lower.bounds = rep(0, 138), upper.bounds = rep(5000, 138),
popsize = 800, generations = 5000)
res_PS <- nsga2(objectif_larves, 138, 1, larves_PS,
lower.bounds = rep(0, 138), upper.bounds = rep(5000, 138),
popsize = 800, generations = 5000)
res_EH <- nsga2(objectif_larves, 138, 1, larves_EH,
lower.bounds = rep(0, 138), upper.bounds = rep(5000, 138),
popsize = 800, generations = 5000)
1:3
1:3 %/%3
1:3 %%3
1:3 %% 3
1:3 %% 4
1:3 %/% 4
1:12 %/% 4
1:12 %/% 3
1:12 +1 %/% 3
(1:12 +1) %/% 3
(1:12 +1) %/% 4
1:3
4:6
7:9
10:12
1:3 -1
0:11 %/% 3
0:11 %/% 3 + 1
id_tri <- 0:11 %/% 3 + 1
id_tri[1]
1:3
4 * 3
toto <- 1
1*3
(toto * 3) : (toto * 3 - 2)
(toto * 3) : (toto * 3 - 2) %>% rev
res_EH
plot(give(res_ER$par[1, ], larves_ER), type = "l", col = "red")
lines(larves_ER[13:80])
?minimise
?minimize
res_ER$par[1, 70]
res_ER$par[1, 69]
res_ER$par[1, 71:138] %>% round
res_ER$par[1, 1:68] %>% round
res_PS$par[1, 70]
res_EH$par[1, 70]
res_PS$par[1, 69]
res_EH$par[1, 69]
138-70
res_ER <- nsga2(objectif_larves, 138, 1, larves_ER,
lower.bounds = c(rep(0, 68), 1, rep(0, 69)), upper.bounds = rep(5000, 138),
popsize = 800, generations = 5000)
res_EH$par[1, 70]
res_ER$par[1, 70]
res_ER$par[1, 69]
plot(give(res_ER$par[1, ], larves_ER), type = "l", col = "red")
lines(larves_ER[13:80])
res_ER <- nsga2(objectif_larves, 138, 1, larves_ER,
lower.bounds = rep(0, 138), upper.bounds = rep(5000, 138),
popsize = 800, generations = 5000)
plot(give(res_ER$par[1, ], larves_ER), type = "l", col = "red")
lines(larves_ER[13:80])
res_ER$par[1, 70]
res_ER$par[1, 70] * res_ER$par[1, 69]
`LOL`
res_EH$par[1, 70] * res_EH$par[1, 69]
res_PS$par[1, 70] * res_PS$par[1, 69]
1 %in% 1:3
8 %in% 1:3
date2017
which(as_date("2017-09-15") %in% date2017)
library(lubridate)
which(as_date("2017-09-15") %in% date2017)
as_date("2017-09-15") %in% date2017
date2017 %in% as_date("2017-09-15")
which(date2017 %in% as_date("2017-09-15"))
as_date("2017-09-15") %in% date2017
source('~/cecidomyie/model_R/model.R')
source('~/cecidomyie/drafts/test_param_saisonnalité.R')
source('~/cecidomyie/drafts/test_param_saisonnalité.R')
arg_opt
larves_est <- dynamics3(arg_opt, inflos2017)
larves_er <- cbind(date = date2017, obs = larves2017[, 1], est = larves_est[, 1]) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
gather(obs, est, key = statut, value = nombre, factor_key = TRUE) %>%
mutate(Sol = factor("ER", levels = c("ER", "PS", "EH")))
larves_er
larves_ps <- cbind(date = date2017, obs = larves2017[, 2], est = larves_est[, 2]) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
gather(obs, est, key = statut, value = nombre, factor_key = TRUE) %>%
mutate(Sol = factor("PS", levels = c("ER", "PS", "EH")))
larves_eh <- cbind(date = date2017, obs = larves2017[, 3], est = larves_est[, 3]) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
gather(obs, est, key = statut, value = nombre, factor_key = TRUE) %>%
mutate(Sol = factor("EH", levels = c("ER", "PS", "EH")))
to_plot <- bind_rows(larves_eh, larves_ps, larves_eh)
to_plot %>% ggplot(aes(x = date, y = nombre, color = statut)) +
geom_line() +
theme_bw() +
facet_grid(Sol ~ .)
to_plot
larves_er <- cbind(date = date2017, obs = larves2017[, 1], est = larves_est[, 1]) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
gather(obs, est, key = statut, value = nombre, factor_key = TRUE) %>%
mutate(Sol = factor("ER", levels = c("ER", "PS", "EH")))
larves_ps <- cbind(date = date2017, obs = larves2017[, 2], est = larves_est[, 2]) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
gather(obs, est, key = statut, value = nombre, factor_key = TRUE) %>%
mutate(Sol = factor("PS", levels = c("ER", "PS", "EH")))
larves_eh <- cbind(date = date2017, obs = larves2017[, 3], est = larves_est[, 3]) %>%
as_tibble %>%
mutate_at("date", as_date) %>%
gather(obs, est, key = statut, value = nombre, factor_key = TRUE) %>%
mutate(Sol = factor("EH", levels = c("ER", "PS", "EH")))
to_plot <- bind_rows(larves_er, larves_ps, larves_eh)
to_plot %>% ggplot(aes(x = date, y = nombre, color = statut)) +
geom_line() +
theme_bw() +
facet_grid(. ~ Sol)
to_plot %>% ggplot(aes(x = date, y = nombre, color = statut)) +
geom_line(lwd = 0.75) +
theme_bw() +
facet_grid(. ~ Sol)
to_plot %>% ggplot(aes(x = date, y = nombre, color = statut)) +
geom_point() +
geom_line(lwd = 0.75) +
theme_bw() +
facet_grid(. ~ Sol)
source('~/cecidomyie/drafts/test_param_saisonnalité.R')
to_plot %>% ggplot(aes(x = date, y = nombre, color = statut)) +
geom_point() +
geom_line(lwd = 0.75) +
theme_bw() +
facet_grid(. ~ Sol)
source('~/cecidomyie/model_R/model.R')
source('~/cecidomyie/drafts/test_param_saisonnalité.R')
to_plot %>% ggplot(aes(x = date, y = nombre, color = statut)) +
geom_point() +
geom_line(lwd = 0.75) +
theme_bw() +
facet_grid(. ~ Sol)
source('~/cecidomyie/model_R/model.R')
source('~/cecidomyie/drafts/test_param_saisonnalité.R')
to_plot %>% ggplot(aes(x = date, y = nombre, color = statut)) +
geom_point() +
geom_line(lwd = 0.75) +
theme_bw() +
facet_grid(. ~ Sol)
arg_opt
